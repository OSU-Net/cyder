{% macro render_table(request, object_table, class) %}
{% if object_table %}

<table id="egtable" class="table {{ class }}">
  <thead>
    <tr>
      {% for header, sort_field in object_table['headers'] %}
        {% if sort_field %}
        <th class="{{ header | lower }}_column">{{ sort_link(request, header, sort_field)|safe }}</th>
        {% else %}
        <th class="{{ header | lower }}_column">{{ header }}</th>
        {% endif %}
      {% endfor %}
    </tr>
  </thead>

  <tbody>
    {% for row in object_table['data'] %}
      <tr id="{{ R ~ loop.index }}" data-url="{{ object_table['postback_urls'][loop.index0] }}">
        {% set i = 0 %}
        {% for col in row %}
          <td class="{{object_table['headers'][i][0] | lower}}_column">
            {% for cell in col['value'] %}
              {% if col['url'][loop.index0] %}
                <a{% if col['class'] %} class="{{ col['class'][loop.index0] }}"{% endif %}
                  {% if col['data'] %}{% if col['data'][loop.index0] %}{% for data in col['data'][loop.index0] %} data-{{ data[0] }}="{{ data[1] }}"{% endfor %}{% endif %}{% endif %}
                  href="{{ col['url'][loop.index0] }}">
                  {% if col['img'] and col['img'][loop.index0] %}
                    <img alt="{{ cell }}" src="{{ col['img'][loop.index0] }}">
                  {% else %}
                    {{ cell }}
                  {% endif %}
                </a>
              {% else %}
                {{ cell }}
              {% endif %}
            {% endfor %}
          </td>
          {% set i = i + 1 %}
        {% endfor %}
      </tr>
    {% endfor %}
  </tbody>
</table>

{% endif %}
{% endmacro %}

{# render a table containing a single object so that it doesn't look like a table #}
{% macro render_object(request, object_table, class) %}
{% if object_table %}
  <table id="obj-info">

    {% set i = 0 %}
    {% for row in object_table['data']%}
      {% for col in row %}
        {% set header, sort_field = object_table['headers'][i] %}
        
        {% if header == "Info" %} {# don't render row for 'Info' because it's useless (links back to same page) #}
          {% set i = i + 1 %}
          {% continue %}
        {% endif %}
        
        {% if header == "Actions" %} {# render all action buttons in the same table cell #}
          <td class = "{{ header | lower }}_column"><b>{{ header }}</b></td>
          <td>
          {% for cell in col['value'] %}
            {% if col['url'][loop.index0] %}
              <a class="info" 
              {% if col['data'] %}
                {% if col['data'][loop.index0] %}
                  {% for data in col['data'][loop.index0] %}
                    data-{{ data[0] }}="{{ data[1] }}"
                  {% endfor %}
                {% endif %}
              {% endif %}
                href="{{ col['url'][loop.index0] }}">
              {% if col['img'] and col['img'][loop.index0] %}
                <img alt="{{ cell }}" src="{{ col['img'][loop.index0] }}"/>
              {% else %}
                {{ cell }} 
              {% endif %}
              </a>
            {% endif %}
          {% endfor %}
          </td>

          {% set i = i + 1 %}
          {% continue %}
        {% endif %}
        <tr>
          {#{% if sort_field %}
            <td class="{{ header | lower }}_column">{{ sort_link(request, header, sort_field)|safe }}</td>
          {% else %}#}
            <td class="{{ header | lower }}_column"><b>{{ header }}</b></td>
          {#{% endif %}#}

          {% for cell in col['value'] %}
            {% if col['url'][loop.index0] %}
              <td><a class="info" 
              {% if col['data'] %}
                {% if col['data'][loop.index0] %}
                  {% for data in col['data'][loop.index0] %}
                    data-{{ data[0] }}="{{ data[1] }}"
                  {% endfor %}
                {% endif %}
              {% endif %}
                href="{{ col['url'][loop.index0] }}">
              {% if col['img'] and col['img'][loop.index0] %}
                <img alt="{{ cell }}" src="{{ col['img'][loop.index0] }}"/>
              {% else %}
                {{ cell }} 
              {% endif %}
              </a></td>
            {% else %}
              <td>{{cell}}</td>
            {% endif %}
          {% endfor %}
        </tr>
        {% set i = i + 1 %}
      {% endfor %}
    {% endfor %}
  </table>
{% endif %}
{% endmacro %}
