{% extends "cydhcp/cydhcp_detail.html" %}
{% from "base/tables.html" import render_table %}
{% from "base/utility.html" import create_button %}
{% block title %}
  {% if range_type == 'st' %}
    Static Range {{ obj.start_str }} to {{ obj.end_str }}
  {% else %}
    Dynamic Range {{ obj.start_str }} to {{ obj.end_str }}
  {% endif %}
{% endblock %}

{% block extra_action_bar %}
  {% if request.user.get_profile().has_perm(request, 2, obj_class=obj_type) %}
    {{ create_button('range_av', url('cydhcp-get-record'),
                     url('range_av'), objName=obj.start_str,
                     buttonName="Range Attribute") }}
  {% endif %}

  {% if request.user.get_profile().has_perm(request, 2, obj_class='dynamicinterface') and obj.range_type == 'dy' %}
  <a class="btn submit a" href={{ url('system-create', 'dynamic_interface_range_' ~ obj.pk ) }}>Create Dynamic Interface</a>
  {% endif %}
{% endblock %}

{% block content %}
  {% if obj.network.pk %}
    <a href="{{ url('build-network', obj.network.pk) }}">DHCP Build Output</a>
  {% endif %}

  {{ render_table(request, ranges_table) }}

  {% if allow_list %}
    <h3>Allowed</h3>
    <table class="table">
        <thead><th>Allowed</th></thead>
        <tbody>
          {% for allow in allow_list %}
            <tr><td>{{ allow }}</td></tr>
          {% endfor %}
        </tbody>
    </table>
  {% endif %}

  {% if attrs_table %}
    <h3>Range Attributes</h3>
    {{ render_table(request, attrs_table) }}
  {% endif %}
  {% if range_used %}
    <h3>Range Usage: {{ range_used }}</h3>
  {% endif %}
  {% if range_data and range_type == 'st' %}
    {% with page_obj = range_data %}
      {% include "base/includes/pagination.html" %}
    {% endwith %}
    <table class="table">
      <thead>
        <th>IP</th>
        <th>Object</th>
        <th>View or Create</th>
      </thead>
      <tbody>
        {% for x in range_data %}
          {% if x[0] == 'Free' %}
          <tr>
              {% if x[1] == x[2] %}
                <td>{{ x[1] }}</td>
              {% else %}
                <td>{{ x[1] }} - {{ x[2] }}</td>
              {% endif %}
              <td>Free</td>
              <td>
                {% if request.user.get_profile().has_perm(request, 2, obj_class='address_record') %}
                  {{ create_button('address_record',
                                   url('cydns-get-record'),
                                   url('address_record'),
                                   data=x[-1],
                                   button_prefix="") }}
                {% endif %}
                {% if request.user.get_profile().has_perm(request, 2, obj_class='ptr') %}
                  {{ create_button('ptr',
                                   url('cydns-get-record'),
                                   url('ptr'),
                                   data=x[-1],
                                   button_prefix="") }}
                                   {% endif %}
                {% if request.user.get_profile().has_perm(request, 2, obj_class='staticinterface') and obj.range_type == 'st' %}
                  <a class="btn submit a" href={{ url('system-create', x[1].__str__()) }}>Static Interface</a>
                {% endif %}
              </td>
            </tr>
          {% else %}
            {% for record_ip, record_set in x %}
              {% for record in record_set %}
                <tr>
                  <td>{{ record_ip }}</td>
                  <td>{{ record._meta.db_table|prettify_obj_type }}</td>
                  {% if record.get_detail_url() %}
                    <td><a href="{{ record.get_detail_url() }}">{{record}}</a></td>
                  {% else %}
                    {% if record.domain %}
                      <td><a href="{{ record.domain.get_detail_url() }}">{{record}}</a></td>
                    {% elif record.reverse_domain %}
                      <td><a href="{{ record.reverse_domain.get_detail_url() }}">{{record}}</a></td>
                    {% else %}
                      <td>{{record}}</td>
                    {% endif %}
                  {% endif %}
                </tr>
              {% endfor %}
            {% endfor %}
          {% endif %}
        {% endfor %}
      </tbody>
    </table>
    {% else %}
      {% if page_obj %}
        {% include "base/includes/pagination.html" %}
      {% endif %}
      {% if dynamic_intr_table %}
        {{ render_table(request, dynamic_intr_table) }}
      {% elif page_obj %}
        {% include "base/includes/object_table.html" %}
      {% endif %}
  {% endif %}
{% endblock %}
